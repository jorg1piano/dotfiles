# ============================================
# tmux config for managing multiple Claude sessions
# ============================================

# --- Better prefix key (optional, Ctrl+a instead of Ctrl+b) ---
# Uncomment these two lines if you prefer Ctrl+a:
# set -g prefix C-a
# unbind C-b

# --- General settings ---
set -g mouse on                          # Enable mouse (click panes, scroll, resize)
set -g base-index 1                      # Windows start at 1, not 0
set -g history-limit 50000               # Lots of scrollback
set -g default-terminal "screen-256color"

# --- Activity & silence monitoring ---
# When Claude is WORKING: output flows = "activity" detected
# When Claude STOPS (waiting for you): "silence" detected after 30s
set -g monitor-activity off              # Don't alert on every output
set -g monitor-silence 0                 # Disabled by default (enabled by claude wrapper function)
set -g silence-action other              # Only flag non-current windows

# --- Status bar ---
set -g status-position bottom
set -g status-style "bg=colour235,fg=colour250"
set -g status-left "#[bg=colour25,fg=white,bold] #S "
set -g status-right "#{pane_current_path} | %H:%M %d-%b-%y"
set -g status-left-length 20

# Window tabs in status bar
set -g window-status-format " #I:#W "
set -g window-status-current-format "#[bg=colour25,fg=white,bold] #I:#W "

# IMPORTANT: This is how you know which window needs you
# Silent windows (Claude waiting for input) turn yellow
set -g window-status-activity-style "fg=colour214,bold"

# Bell-triggered style: Claude finished a response and needs your input
# This gets a bright red BACKGROUND so it really stands out
set -g window-status-bell-style "bg=red,fg=white,bold"
set -g bell-action other              # Only flag non-focused windows
set -g visual-bell off                # Don't show a status bar message, just color the tab

# --- Easy window navigation ---
# Alt+1/2/3/4 to jump to a window directly
bind -n M-1 select-window -t 1
bind -n M-2 select-window -t 2
bind -n M-3 select-window -t 3
bind -n M-4 select-window -t 4

# Alt+Left/Right to move between windows
bind -n M-Left previous-window
bind -n M-Right next-window

# When renaming start with no name
bind-key , command-prompt -p "rename-window:" "rename-window '%%'"

# Reload config
bind r source-file ~/.tmux.conf \; display-message "Config reloaded!"

# nicer view for leader + w
bind-key w choose-tree -ZwF "#{?pane_format,,#{?window_format,  #[fg=white]#{window_name}#[default],#[fg=magenta]#{session_name}#[default]}}"

# set-window-option -g mode-style "fg=white,bg=blue,bold"
set-window-option -g mode-style "fg=white,bg=black"

# --- Easy pane splitting (more intuitive keys) ---
# Show pane path menu with prefix+q
bind q display-menu -T "#{pane_current_path}" \
  "Copy path"       c "run-shell 'echo #{pane_current_path} | pbcopy'" \
  "Open in VS Code" v "run-shell 'code #{pane_current_path}'"

bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"
bind '"' split-window -v -c "#{pane_current_path}"
bind % split-window -h -c "#{pane_current_path}"
bind c new-window -c "#{pane_current_path}"

# --- Auto-name sessions based on directory ---
set-hook -g session-created 'run-shell "tmux rename-session $(basename #{pane_current_path})"'

# --- Auto-name windows based on directory ---
set-option -g automatic-rename on
set-option -g automatic-rename-format "#{s|$HOME/github/devda/sendi/web|Sendi Web|; s|$HOME/github/devda/sendi/mobile|Sendi Mobile|; s|$HOME/github/devda/sendi|Sendi|; s|$HOME|~|:pane_current_path}"
set-hook -g after-select-pane 'run-shell "tmux set-window-option automatic-rename on"'


set -g pane-border-status top
set -g pane-border-format "#[fg=#bd93f9,bold][ #(echo #{pane_current_path} | sed \"s|$HOME/github/devda/sendi/web|Sendi Web|; s|$HOME/github/devda/sendi/mobile|Sendi Mobile|; s|$HOME/github/devda/sendi|Sendi|; s|$HOME|~|\") ]"

# Force pane border refresh on directory change
set-hook -g pane-focus-in "refresh-client -S"
set-option -g status-interval 1
bind-key -T copy-mode-vi v send-keys -X begin-selection
setw -g mode-keys vi
bind-key -T copy-mode-vi y send-keys -X copy-selection
